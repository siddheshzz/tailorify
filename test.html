from fastapi.responses import HTMLResponse

@router.get("/{order_id}/upload-test", response_class=HTMLResponse)
def upload_test_page(order_id: str):
    return f"""
    <!DOCTYPE html>
    <html>
    <head>
        <title>S3 Upload Test</title>
    </head>
    <body>
        <h1>Upload Image for Order {order_id}</h1>
        <button onclick="uploadFile()">Select and Upload File</button>
        <div id="status"></div>
        
        <script>
            async function uploadFile() {{
                const orderId = '{order_id}';
                const status = document.getElementById('status');
                
                // Step 1: Get presigned URL
                status.innerHTML = 'Getting upload URL...';
                const urlResponse = await fetch(`/orders/${{orderId}}/generate-upload-url`, {{
                    headers: {{
                        'Authorization': 'Bearer YOUR_TOKEN_HERE'
                    }}
                }});
                const {{ url, s3_object_path }} = await urlResponse.json();
                
                // Step 2: Select file
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = async (e) => {{
                    const file = e.target.files[0];
                    status.innerHTML = 'Uploading to S3...';
                    
                    // Step 3: Upload to S3
                    const uploadResponse = await fetch(url, {{
                        method: 'PUT',
                        body: file,
                        headers: {{
                            'Content-Type': file.type
                        }}
                    }});
                    
                    if (uploadResponse.ok) {{
                        status.innerHTML = 'Confirming upload...';
                        
                        // Step 4: Confirm with backend
                        const confirmResponse = await fetch(`/orders/${{orderId}}/confirm-upload`, {{
                            method: 'POST',
                            headers: {{
                                'Content-Type': 'application/json',
                                'Authorization': 'Bearer YOUR_TOKEN_HERE'
                            }},
                            body: JSON.stringify({{ s3_object_path }})
                        }});
                        
                        if (confirmResponse.ok) {{
                            status.innerHTML = 'Upload successful!';
                        }} else {{
                            status.innerHTML = 'Confirmation failed!';
                        }}
                    }} else {{
                        status.innerHTML = 'Upload to S3 failed!';
                    }}
                }};
                input.click();
            }}
        </script>
    </body>
    </html>
    """